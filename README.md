# HubSpot Signal Matcher\n\nAn intelligent agent that matches HubSpot Signals to Companies and Contacts using semantic embeddings and vector similarity search.\n\n## Features\n\n- **Semantic Matching**: Uses OpenAI embeddings to match signal descriptions to company/contact records\n- **Vector Database**: Stores embeddings in Supabase with pgvector for fast similarity search\n- **Scheduled Sync**: Daily GitHub Actions workflow to keep embeddings up-to-date\n- **Batch Processing**: Process all unmatched signals on a schedule\n- **Match Logging**: Full audit trail of all matches for debugging\n\n## Architecture\n\n```\nHubSpot Signals --> OpenAI Embeddings --> Supabase pgvector --> Best Match --> Create Association\n```\n\n### Components\n\n| Component | Purpose |\n|-----------|---------|\n| `lib/hubspot_client.py` | HubSpot API interactions |\n| `lib/supabase_client.py` | Vector database operations |\n| `lib/embeddings.py` | OpenAI embedding generation |\n| `lib/matcher.py` | Core matching logic |\n| `scripts/initial_setup.py` | One-time bulk embedding |\n| `scripts/daily_sync.py` | Incremental sync |\n| `scripts/process_all_signals.py` | Match unassociated signals |\n\n## Setup\n\n### 1. Supabase Setup\n\n1. Create a new Supabase project (or use existing)\n2. Run the schema from `supabase/schema.sql` in the SQL Editor\n3. Note your project URL and anon key\n\n### 2. GitHub Secrets\n\nAdd these secrets to your repository:\n\n| Secret | Description |\n|--------|-------------|\n| `HUBSPOT_ACCESS_TOKEN` | HubSpot Private App token with CRM scopes |\n| `SUPABASE_URL` | Your Supabase project URL |\n| `SUPABASE_KEY` | Your Supabase anon key |\n| `OPENAI_API_KEY` | OpenAI API key for embeddings |\n\n### 3. Initial Setup\n\nRun the initial setup to embed all existing companies and contacts:\n\n```bash\n# Install dependencies\npip install -r requirements.txt\n\n# Set environment variables\nexport HUBSPOT_ACCESS_TOKEN=your_token\nexport SUPABASE_URL=https://xxx.supabase.co\nexport SUPABASE_KEY=your_key\nexport OPENAI_API_KEY=your_key\n\n# Run initial embedding (may take hours for large datasets)\npython scripts/initial_setup.py\n```\n\n## Usage\n\n### Manual Signal Matching\n\n```bash\n# Match a specific signal\npython scripts/match_signal.py <signal_id>\n\n# Match with custom threshold\npython scripts/match_signal.py <signal_id> --threshold 0.80\n```\n\n### Scheduled Jobs\n\nTwo GitHub Actions workflows run automatically:\n\n1. **Daily Sync** (2 AM UTC): Updates embeddings for modified companies/contacts\n2. **Process Signals** (3 AM UTC): Matches any unassociated signals\n\nYou can also trigger these manually from the Actions tab.\n\n## Configuration\n\n| Environment Variable | Default | Description |\n|---------------------|---------|-------------|\n| `CONFIDENCE_THRESHOLD` | `0.85` | Minimum similarity score for auto-association |\n\n## HubSpot Requirements\n\n### Private App Scopes\n\n- `crm.objects.custom.read`\n- `crm.objects.custom.write`\n- `crm.objects.companies.read`\n- `crm.objects.contacts.read`\n- `crm.schemas.custom.read`\n\n### Custom Object\n\nThis agent is configured for the "Signals" custom object (ID: `2-54609655`) with these properties:\n- `signal_description` - Used for matching\n- `signal_citation` - Used for matching\n- `signal_type` - Determines if matching to company, contact, or both\n\n## Cost Estimates\n\n| Operation | Cost |\n|-----------|------|\n| Initial embedding (100K companies) | ~$1.50 |\n| Daily sync (100-200 records) | ~$0.01/day |\n| Signal matching (50-200/day) | ~$0.01/day |\n| Supabase (free tier) | $0 |\n\n## License\n\nMIT\n